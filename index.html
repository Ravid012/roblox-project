// --- 1. THE SAVING MECHANISM (On Login Success) ---
function onLoginSuccess(apiResponse) {
    // The server sends back a 'token' (your digital ID card)
    const sessionToken = apiResponse.token;

    // We store it in LocalStorage so it survives a browser restart
    localStorage.setItem('game_auth_token', sessionToken);
    
    console.log("Session persisted to local storage.");
}

// --- 2. THE LOADING MECHANISM (On Page Refresh) ---
function initGameSession() {
    // When the player hits 'Refresh' or returns the next day:
    const savedToken = localStorage.getItem('game_auth_token');

    if (savedToken) {
        // We found a key! Now we ask the server if it's still valid.
        validateTokenWithServer(savedToken);
    } else {
        // No key found. Redirect to the login screen.
        showLoginOverlay();
    }
}

// --- 3. THE DATA FLOW (Sending the Key) ---
function performGameAction(actionType) {
    const token = localStorage.getItem('game_auth_token');

    // Every time you click 'Attack' or 'Trade', the token goes with it
    fetch('/api/game/action', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ action: actionType })
    });
}
